<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Beach Volley Scheduler</title>
    <style>
        /* ... (tutto il tuo CSS esistente rimane uguale) ... */
    </style>
</head>
<body>
    <!-- ... (tutto il tuo HTML esistente rimane uguale fino a <script>) ... -->

<script>
    // =============================================
    // PARTE 1: MODIFICA QUESTI 3 VALORI!
    // =============================================
    const GITHUB_USERNAME = "masca87";  // Es: "mario-rossi"
    const REPO_NAME = "beachvolley";          // Es: "beach-volley-scheduler"
   let GITHUB_TOKEN = localStorage.getItem('github_token');
if(!GITHUB_TOKEN) {
  GITHUB_TOKEN = prompt("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");
  localStorage.setItem('github_token', GITHUB_TOKEN);
}

    // =============================================
    // PARTE 2: CODICE MODIFICATO (DA QUI IN GIÃ™ NON TOCCARE)
    // =============================================
    let user = JSON.parse(localStorage.getItem('user'));
    let events = [];

    async function loadEvents() {
        try {
            const today = new Date();
            today.setHours(0,0,0,0);
            
            // Carica gli eventi da GitHub
            const response = await fetch(
                `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/events.json`,
                {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                }
            );

            if (!response.ok) throw new Error("Errore nel caricamento");
            
            const data = await response.json();
            let remoteEvents = JSON.parse(atob(data.content));
            
            // ... (il resto del tuo codice originale rimane uguale) ...
            events = remoteEvents.filter(e => new Date(e.date) >= today);
            
            // Assicurati di avere 14 giorni di copertura
            for (let i = 0; i < 14; i++) {
                const day = new Date(today);
                day.setDate(today.getDate() + i);
                const dayStr = day.toISOString().split('T')[0];
                
                if (!events.some(e => e.date.startsWith(dayStr))) {
                    events.push({ 
                        id: Date.now() + i, 
                        date: day.toISOString(), 
                        place: '', 
                        participants: [] 
                    });
                }
            }
            
            renderGrid(events);
            
        } catch (error) {
            console.error("Errore:", error);
            // Fallback agli eventi locali
            events = JSON.parse(localStorage.getItem('events')) || [];
            renderGrid(events);
            showToast("Connessione fallita, usando dati locali");
        }
    }

    async function saveEvents() {
        try {
            // Prima otteniamo l'SHA del file esistente
            const getResponse = await fetch(
                `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/events.json`,
                {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                }
            );
            
            const fileData = await getResponse.json();
            const sha = fileData.sha;

            // Poi aggiorniamo il file
            const updateResponse = await fetch(
                `https://api.github.com/repos/${GITHUB_USERNAME}/${REPO_NAME}/contents/events.json`,
                {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Aggiornamento eventi beach volley',
                        content: btoa(JSON.stringify(events)),
                        sha: sha
                    })
                }
            );

            if (!updateResponse.ok) throw new Error("Salvataggio fallito");
            
            // Salva anche localmente
            localStorage.setItem('events', JSON.stringify(events));
            return true;
            
        } catch (error) {
            console.error("Errore:", error);
            return false;
        }
    }

    // ... (tutte le altre tue funzioni ESISTENTI rimangono UGUALI) ...

</script>
</body>
</html>
