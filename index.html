<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calendario Partite</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; }
    .login, .calendar { max-width: 600px; margin: auto; }
    .day-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .day {
      border: 1px solid #aaa;
      padding: 0.5rem;
      border-radius: 5px;
      cursor: pointer;
      min-height: 80px;
      background: #f9f9f9;
    }
    .day:hover { background: #eee; }
    .participants { font-size: 0.85rem; margin-top: 0.5rem; }
    .hidden { display: none; }
  </style>
</head>
<body>

<div class="login">
  <h2>Benvenuto</h2>
  <input type="text" id="name" placeholder="Il tuo nome"><br><br>
  <input type="text" id="phone" placeholder="Numero di telefono"><br><br>
  <button onclick="enter()">Entra</button>
</div>

<div class="calendar hidden">
  <h2>Calendario prossime 2 settimane</h2>
  <div class="day-grid" id="calendar"></div>
</div>

<script>
  const today = new Date();
  const calendarDiv = document.getElementById('calendar');
  const user = { name: '', phone: '' };

  function formatDate(date) {
    return date.toISOString().split('T')[0];
  }

  function loadDays() {
    calendarDiv.innerHTML = '';
    const events = JSON.parse(localStorage.getItem('events') || '{}');

    for (let i = 0; i < 14; i++) {
      const date = new Date();
      date.setDate(today.getDate() + i);
      const key = formatDate(date);

      if (!events[key]) events[key] = [];

      const div = document.createElement('div');
      div.className = 'day';
      div.innerHTML = `<strong>${key}</strong><div class="participants">${events[key].length} iscritti</div>`;
      div.onclick = () => handleDayClick(key, events);

      calendarDiv.appendChild(div);
    }

    localStorage.setItem('events', JSON.stringify(events));
  }

  function handleDayClick(date, events) {
    if (events[date].some(e => e.phone === user.phone)) {
      alert("Hai giÃ  partecipato a questo giorno.");
      return;
    }

    const plus = prompt("Vuoi aggiungere +1 o +2? (scrivi 0, 1 o 2)");
    const plusInt = Math.min(2, Math.max(0, parseInt(plus)));
    const guests = [];

    for (let i = 0; i < plusInt; i++) {
      const gname = prompt(`Nome del tuo +${i+1}`);
      if (gname) guests.push(gname);
    }

    events[date].push({ name: user.name, phone: user.phone, guests });
    localStorage.setItem('events', JSON.stringify(events));
    loadDays();

    if (events[date].length >= 4) {
      alert("ðŸŽ‰ Giorno con almeno 4 partecipanti! (notifica da implementare)");
    }
  }

  function enter() {
    const name = document.getElementById('name').value.trim();
    const phone = document.getElementById('phone').value.trim();

    if (!name || !phone) {
      alert("Compila entrambi i campi");
      return;
    }

    user.name = name;
    user.phone = phone;

    document.querySelector('.login').classList.add('hidden');
    document.querySelector('.calendar').classList.remove('hidden');
    loadDays();
  }
</script>

</body>
</html>

